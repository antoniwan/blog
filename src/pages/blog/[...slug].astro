---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import PageSection from '../../components/PageSection.astro';
import FormattedDate from '../../components/FormattedDate.astro';

export const prerender = true;

export async function getStaticPaths() {
	const posts = await getCollection('blog', ({ data }) => {
		return import.meta.env.PROD ? !data.draft : true;
	});
	
	return posts.map((post) => ({
		params: { slug: post.id },
		props: { post },
	}));
}

const { post } = Astro.props;
const { data } = post;
---

<BaseLayout
	title={data.title}
	description={data.description}
	pubDate={data.pubDate}
	updatedDate={data.updatedDate}
	language={data.language}
	category={data.category}
	tags={data.tags}
	layoutType="blog"
	contentWidth="default"
	spacing="comfortable"
>
	<PageSection width="default" spacing="comfortable" class="text-center">
		<h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-6 text-text dark:text-text-dark leading-tight tracking-tight">
			{data.title}
		</h1>
		<div class="flex items-center justify-center gap-4 text-neutral-600 dark:text-neutral-400">
			<time datetime={data.pubDate.toISOString()}>
				<FormattedDate date={data.pubDate} format="long" />
			</time>
			{data.category && data.category.length > 0 && (
				<span class="flex items-center gap-1">
					<span class="text-lg" aria-hidden="true">ğŸ“</span>
					<a 
						href={`/category/${data.category[0]}/`} 
						class="hover:text-primary-500 dark:hover:text-primary-400 transition-colors"
					>
						{data.category[0]}
					</a>
				</span>
			)}
		</div>
	</PageSection>

	<PageSection width="default" spacing="default">
		<article class="prose dark:prose-invert max-w-none">
			{post.body}
		</article>
	</PageSection>
</BaseLayout>
---
