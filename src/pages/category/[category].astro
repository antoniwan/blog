---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import Section from '../../components/Section.astro';
import { getCollection } from 'astro:content';
import { categories } from '../../data/categories';

export async function getStaticPaths() {
	return categories.map(category => ({
		params: { category: category.id },
		props: { category },
	}));
}

const { category } = Astro.props;

// Get all posts in this category
const posts = await getCollection('blog', ({ data }) => {
	return import.meta.env.PROD ? !data.draft : true;
});

// Filter posts by category
const categoryPosts = posts
	.filter(post => post.data.category?.includes(category.id))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout
	title={`${category.name} - Category`}
	description={`Browse all posts in the ${category.name} category`}
	layoutType="default"
	contentWidth="default"
	spacing="comfortable"
>
	<Section>
		<h1>{category.name}</h1>
		<p>{category.description}</p>
	</Section>

	<Section>
		<nav>
			{categoryPosts.map(post => (
				<PostCard post={post} />
			))}
		</nav>
	</Section>
</BaseLayout> 