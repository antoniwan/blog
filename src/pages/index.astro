---
import HomeLayout from '../layouts/HomeLayout.astro';
import PostCard from '../components/PostCard.astro';
import LayoutContainer from '../components/LayoutContainer.astro';
import { getCollection } from 'astro:content';
import { categories } from '../data/categories';

// Get all posts
const posts = await getCollection('blog', ({ data }) => {
	return import.meta.env.PROD ? !data.draft : true;
});

// Sort posts by date
const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Get post counts by category
const postCounts = categories.reduce((acc, category) => {
	acc[category.id] = posts.filter(post => post.data.category?.includes(category.id)).length;
	return acc;
}, {} as Record<string, number>);

// Get post counts by tag
const tagCounts = posts.reduce((acc, post) => {
	post.data.tags?.forEach(tag => {
		acc[tag] = (acc[tag] || 0) + 1;
	});
	return acc;
}, {} as Record<string, number>);
---

<HomeLayout
	title="Welcome to the Strong Vault"
	description="Notes on strength, clarity, ritual, and creation — one builder's journey through code, craft, and self-mastery."
	fullWidth={true}
	containerPadding="xl"
	contentMaxWidth="container"
>
	{/* Hero Section */}
	<LayoutContainer padding="none" maxWidth="prose-wide" class="mb-16">
		<h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-text dark:text-text-dark leading-tight tracking-tight mb-6">
			Welcome to the Strong Vault
		</h1>
		<p class="text-xl md:text-2xl text-neutral-600 dark:text-neutral-400 leading-relaxed">
			Notes on strength, clarity, ritual, and creation — one builder's journey through code, craft, and self-mastery.
		</p>
	</LayoutContainer>

	{/* Latest Posts Section */}
	<LayoutContainer padding="none" maxWidth="container" hasBorder>
		<div class="space-y-8">
			{sortedPosts.map(post => (
				<PostCard post={post} />
			))}
		</div>
	</LayoutContainer>
</HomeLayout>

<style>
	/* Smooth transitions for dark mode */
	main {
		transition: background-color 150ms cubic-bezier(0.4, 0, 0.2, 1),
					color 150ms cubic-bezier(0.4, 0, 0.2, 1);
	}

	/* Respect reduced motion preferences */
	@media (prefers-reduced-motion: reduce) {
		main {
			transition: none !important;
		}
	}

	@media (max-width: 768px) {
		.hero-section h1 {
			font-size: var(--font-size-3xl);
		}

		.subtitle {
			font-size: var(--font-size-lg);
		}
	}
</style>
