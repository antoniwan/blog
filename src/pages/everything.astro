---
import PageLayout from '../layouts/PageLayout.astro';
import Container from '../components/Container.astro';
import LazyPosts from '../components/LazyPosts.astro';
import { getCollection } from 'astro:content';

// Get all published posts
const posts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});

// Sort posts by date (newest first)
const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<PageLayout
  title="Everything (All Posts)"
  description="The full record, newest to oldest."
  path="/everything"
  structuredDataType="website"
>
  <Container>
    <div class="mb-8 md:mb-12">
      <h1 class="text-heading mb-4 text-[rgb(var(--color-text))]">Everything (All Posts)</h1>
      <p class="text-body-large leading-relaxed text-[rgb(var(--color-text-muted))]">
        The full record, newest to oldest.
      </p>
    </div>

    {sortedPosts.length > 0 ? (
      <LazyPosts posts={sortedPosts} initialCount={12} loadMoreCount={12} />
    ) : (
      <div class="py-16 text-center md:py-20">
        <div class="mx-auto max-w-md">
          <div class="mb-6 text-6xl">ğŸ“</div>
          <h2 class="text-heading mb-4 text-[rgb(var(--color-text))]">No posts yet</h2>
          <p class="text-body-large leading-relaxed text-[rgb(var(--color-text-muted))]">
            Posts will appear here once they're published.
          </p>
        </div>
      </div>
    )}
  </Container>
</PageLayout>

