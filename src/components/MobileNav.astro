---
import { mainNavigation } from '../data/navigation';
import Search from './Search.astro';
import Icon from './Icon.astro';
---

<button
  id="mobile-menu-button"
  type="button"
  aria-label="Open menu"
  aria-expanded="false"
  aria-controls="mobile-menu"
>
  <Icon name="menu" />
</button>

<aside
  id="mobile-menu"
  class="hidden"
  tabindex="-1"
  aria-modal="true"
  role="dialog"
>
  <header>
    <span>Menu</span>
    <button
      type="button"
      aria-label="Close menu"
      id="close-mobile-menu"
    >
      <Icon name="x" />
    </button>
  </header>

  <Search />

  <nav>
    <ul>
      {mainNavigation.map((item) => (
        <li>
          <a href={item.href}>
            {item.label}
          </a>
          {item.dropdown && (
            <ul>
              {item.dropdown.items.map((dropdownItem) => (
                <li>
                  <a href={dropdownItem.href}>
                    {dropdownItem.icon && <span aria-hidden="true">{dropdownItem.icon}</span>}
                    {dropdownItem.label}
                  </a>
                </li>
              ))}
            </ul>
          )}
        </li>
      ))}
    </ul>
  </nav>
</aside>

<script>
  const menuButton = document.getElementById('mobile-menu-button');
  const menu = document.getElementById('mobile-menu');
  const closeButton = document.getElementById('close-mobile-menu');

  function openMenu() {
    if (!menu || !menuButton) return;
    menu.classList.remove('hidden');
    menuButton.setAttribute('aria-expanded', 'true');
    document.body.classList.add('overflow-hidden');
    menu.focus();
  }
  function closeMenu() {
    if (!menu || !menuButton) return;
    menu.classList.add('hidden');
    menuButton.setAttribute('aria-expanded', 'false');
    document.body.classList.remove('overflow-hidden');
    menuButton.focus();
  }

  menuButton?.addEventListener('click', openMenu);
  closeButton?.addEventListener('click', closeMenu);

  menu?.addEventListener('click', (e) => {
    if (e.target === menu) closeMenu();
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && menu && !menu.classList.contains('hidden')) {
      closeMenu();
    }
  });

  if (menu) {
    menu.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', closeMenu);
    });
  }
</script> 