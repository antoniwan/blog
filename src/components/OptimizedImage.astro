---
import { Image } from 'astro:assets';

interface Props {
  src: string;
  alt: string;
  width?: number;
  height?: number;
  class?: string;
  loading?: 'lazy' | 'eager';
  priority?: boolean;
  aspectRatio?: string;
}

const { 
  src, 
  alt, 
  width, 
  height, 
  class: className = '', 
  loading = 'lazy', 
  priority = false,
  aspectRatio
} = Astro.props;

// Convert aspect ratio string to number (e.g., "16/9" to 16/9)
const aspectRatioValue = aspectRatio ? eval(aspectRatio) : undefined;

---
<div class={`relative overflow-hidden ${aspectRatio ? 'aspect-ratio' : ''} ${className}`}>
  <Image
    src={src}
    alt={alt}
    width={width || 800}
    height={height || 600}
    loading={loading}
    class={`w-full h-full object-cover transition-all duration-300 ${loading === 'lazy' ? 'blur-sm' : ''}`}
  />
  <div class="absolute inset-0 bg-gray-light/20 dark:bg-gray/20 transition-opacity duration-300"></div>
</div>

<style>
  .aspect-ratio {
    position: relative;
    padding-bottom: calc(var(--aspect-ratio, 56.25%) * 100%);
  }

  .aspect-ratio > :global(img) {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Respect reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .aspect-ratio > :global(img),
    .aspect-ratio > div {
      transition: none;
    }
  }
</style>

<script define:vars={{ aspectRatioValue }}>
  if (aspectRatioValue) {
    const container = document.currentScript?.parentElement;
    if (container) {
      container.style.setProperty('--aspect-ratio', aspectRatioValue);
    }
  }
</script> 