---
interface Props {
  class?: string;
}

const { class: className = '' } = Astro.props;
---

<button
  type="button"
  class:list={[
    'group invisible fixed bottom-8 right-8 z-50 inline-flex translate-y-4 items-center justify-center rounded-full bg-[rgb(var(--color-primary))] p-3 text-white opacity-0 shadow-lg transition-all duration-300 hover:bg-[rgb(var(--color-primary-hover))]',
    'border border-white/20',
    className,
  ]}
  aria-label="Back to top"
  id="back-to-top"
>
  <!-- Main icon -->
  <svg
    class="h-6 w-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
    aria-hidden="true"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2.5"
      d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
  </svg>
</button>

<script>
  const backToTop = document.getElementById('back-to-top');
  let isVisible = false;
  let ticking = false;

  function toggleBackToTop() {
    if (!backToTop) return;

    const shouldBeVisible = window.scrollY > 300;

    if (shouldBeVisible !== isVisible) {
      if (shouldBeVisible) {
        backToTop.classList.remove('opacity-0', 'invisible', 'translate-y-4');
        backToTop.classList.add('opacity-100', 'visible', 'translate-y-0');
        // Add entrance animation
        backToTop.style.animation = 'fade-in 0.3s ease-out';
      } else {
        backToTop.classList.add('opacity-0', 'invisible', 'translate-y-4');
        backToTop.classList.remove('opacity-100', 'visible', 'translate-y-0');
        backToTop.style.animation = '';
      }
      isVisible = shouldBeVisible;
    }

    ticking = false;
  }

  function throttledToggle() {
    if (!ticking) {
      window.requestAnimationFrame(toggleBackToTop);
      ticking = true;
    }
  }

  function scrollToTop() {
    // Check if smooth scrolling is supported
    if ('scrollBehavior' in document.documentElement.style) {
      window.scrollTo({
        top: 0,
        behavior: 'smooth',
      });
    } else {
      // Fallback for older browsers
      window.scrollTo(0, 0);
    }
  }

  window.addEventListener('scroll', throttledToggle, { passive: true });
  backToTop?.addEventListener('click', scrollToTop);
</script>

<style>
  #back-to-top {
    transition: opacity 0.3s ease, transform 0.3s ease, background-color 0.2s ease;
  }

  #back-to-top:hover {
    box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.2);
  }

  @keyframes fade-in {
    0% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    #back-to-top {
      animation: none !important;
      transition: none !important;
    }

    #back-to-top:hover {
      transform: none !important;
    }
  }
</style>
